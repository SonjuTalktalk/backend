# GitHub Actions 워크플로우 이름
name: Deploy Backend to Elastic Beanstalk

# 이 워크플로우가 언제 실행될지 정의
on:
  push:
    branches:
      - main  # 'main' 브랜치에 push 이벤트가 발생할 때만 실행

jobs:
  deploy:
    runs-on: ubuntu-latest  # 작업은 'ubuntu'라는 가상 머신에서 실행
    steps:
      # 1. GitHub 저장소의 코드를 가상 머신으로 가져옴
      - name: Checkout code
        uses: actions/checkout@v3

      # [!!! 중요: 이 부분이 추가되어야 합니다 !!!]
      # 코드를 deploy.zip 파일로 압축하는 단계
      - name: Generate deployment package
        run: zip -r deploy.zip . -x "*.git*"

      # 2. Elastic Beanstalk 배포를 실행
      - name: Deploy to Elastic Beanstalk
        uses: einaregilsson/beanstalk-deploy@v21
        with:
          # --- 2단계에서 설정한 GitHub Secrets 사용 ---
          aws_access_key: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws_secret_key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          
          # --- 님의 EB 정보 ---
          application_name: Coopteam7-beanstalk 
          environment_name: Coopteam7-beanstalk-env
          region: 'ap-northeast-2'
          
          # --- 기타 설정 ---
          version_label: "gh-${{ github.sha }}" 
          deployment_package: deploy.zip  # 위에서 만든 압축 파일을 배포